<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Ajay Kumar Gaur</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .login-box {
            background: white;
            padding: 3rem;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .login-box h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            background: #7c3aed;
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
        }
        
        .btn:hover {
            background: #6d28d9;
        }
        
        .error-message {
            color: #dc2626;
            margin-top: 1rem;
            text-align: center;
        }
        
        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
        }
        
        .admin-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-nav {
            background: #1e293b;
            color: white;
            width: 250px;
            min-height: calc(100vh - 70px);
            padding: 2rem 0;
        }
        
        .admin-nav ul {
            list-style: none;
        }
        
        .admin-nav li {
            margin-bottom: 0.5rem;
        }
        
        .nav-link {
            display: block;
            padding: 1rem 2rem;
            color: white;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .nav-link:hover,
        .nav-link.active {
            background: #374151;
        }
        
        .admin-content {
            flex: 1;
            padding: 2rem;
        }
        
        .admin-layout {
            display: flex;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .dashboard-card {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Editor Styles */
        .editor-container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }
        
        .editor-group {
            margin-bottom: 2rem;
        }
        
        .editor-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .editor-group input,
        .editor-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .editor-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .image-upload {
            border: 2px dashed #ddd;
            padding: 2rem;
            text-align: center;
            border-radius: 10px;
            margin-top: 1rem;
            cursor: pointer;
        }
        
        .image-preview {
            max-width: 200px;
            margin-top: 1rem;
            border-radius: 5px;
        }
        
        .items-list {
            margin-top: 1rem;
        }
        
        .item-card {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            width: auto;
            margin-right: 0.5rem;
        }
        
        .btn-danger {
            background: #dc2626;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        /* Loading Spinner */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #7c3aed;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success Message */
        .success-message {
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h2>Admin Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn">Login</button>
                <div id="loginError" class="error-message"></div>
            </form>
            
            <!-- Default Login Credentials -->
            <div style="margin-top: 2rem; padding: 1rem; background: #f3f4f6; border-radius: 5px; font-size: 0.875rem;">
                <p><strong>Default Login:</strong></p>
                <p>Username: admin</p>
                <p>Password: admin123</p>
                <p style="margin-top: 1rem; color: #666;">Change these credentials in the admin panel.</p>
            </div>
        </div>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    
    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard">
        <div class="admin-header">
            <h2>Admin Panel</h2>
            <button onclick="logout()" class="btn btn-danger">Logout</button>
        </div>
        
        <div class="admin-layout">
            <nav class="admin-nav">
                <ul>
                    <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">Dashboard</a></li>
                    <li><a href="#hero" class="nav-link" onclick="showSection('hero')">Hero Section</a></li>
                    <li><a href="#about" class="nav-link" onclick="showSection('about')">About Section</a></li>
                    <li><a href="#services" class="nav-link" onclick="showSection('services')">Services</a></li>
                    <li><a href="#skills" class="nav-link" onclick="showSection('skills')">Skills</a></li>
                    <li><a href="#projects" class="nav-link" onclick="showSection('projects')">Projects</a></li>
                    <li><a href="#contact" class="nav-link" onclick="showSection('contact')">Contact Info</a></li>
                    <li><a href="#messages" class="nav-link" onclick="showSection('messages')">Contact Messages</a></li>
                    <li><a href="#settings" class="nav-link" onclick="showSection('settings')">Settings</a></li>
                </ul>
            </nav>
            
            <main class="admin-content">
                <!-- Success Message -->
                <div id="successMessage" class="success-message"></div>
                
                <!-- Dashboard -->
                <div id="dashboardSection" class="section-content">
                    <h2>Dashboard</h2>
                    <p>Welcome to the admin panel. Use the navigation to edit different sections of your website.</p>
                    
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3>Quick Stats</h3>
                            <div id="quickStats" style="margin-top: 1rem;"></div>
                        </div>
                        
                        <div class="dashboard-card">
                            <h3>Recent Messages</h3>
                            <div id="recentMessages" style="margin-top: 1rem;"></div>
                        </div>
                        
                        <div class="dashboard-card">
                            <h3>Website Preview</h3>
                            <p style="margin: 1rem 0;">View your website:</p>
                            <a href="index.html" target="_blank" class="btn">View Website</a>
                        </div>
                    </div>
                </div>
                
                <!-- Hero Section Editor -->
                <div id="heroSection" class="section-content" style="display: none;">
                    <h2>Edit Hero Section</h2>
                    <div class="editor-container">
                        <div class="editor-group">
                            <label>Site Title</label>
                            <input type="text" id="siteTitle" placeholder="Ajay Kumar Gaur">
                        </div>
                        
                        <div class="editor-group">
                            <label>Hero Title</label>
                            <input type="text" id="heroTitle" placeholder="Digital Marketing Consultant">
                        </div>
                        
                        <div class="editor-group">
                            <label>Hero Subtitle</label>
                            <textarea id="heroSubtitle" placeholder="Helping businesses grow with digital marketing..."></textarea>
                        </div>
                        
                        <div class="editor-group">
                            <label>Profile Image</label>
                            <div id="imageUpload" class="image-upload">
                                Click to upload profile image
                                <input type="file" id="profileImageInput" accept="image/*" style="display: none;">
                            </div>
                            <img id="profileImagePreview" class="image-preview" src="" alt="Preview">
                        </div>
                        
                        <div class="editor-group">
                            <label>Statistics</label>
                            <div id="statsContainer"></div>
                            <button type="button" onclick="addStat()" class="btn btn-sm btn-secondary" style="margin-top: 1rem;">Add Stat</button>
                        </div>
                        
                        <button onclick="saveHero()" class="btn">Save Hero Section</button>
                    </div>
                </div>
                
                <!-- About Section Editor -->
                <div id="aboutSection" class="section-content" style="display: none;">
                    <h2>Edit About Section</h2>
                    <div class="editor-container">
                        <div class="editor-group">
                            <label>About Content (HTML allowed)</label>
                            <textarea id="aboutContent" rows="10" placeholder="Enter your about content here..."></textarea>
                        </div>
                        <button onclick="saveAbout()" class="btn">Save About Section</button>
                    </div>
                </div>
                
                <!-- Services Editor -->
                <div id="servicesSection" class="section-content" style="display: none;">
                    <h2>Edit Services</h2>
                    <div class="editor-container">
                        <div id="servicesList" class="items-list"></div>
                        <button onclick="addService()" class="btn btn-secondary">Add New Service</button>
                        <button onclick="saveServices()" class="btn" style="margin-top: 2rem;">Save All Services</button>
                    </div>
                </div>
                
                <!-- Skills Editor -->
                <div id="skillsSection" class="section-content" style="display: none;">
                    <h2>Edit Skills</h2>
                    <div class="editor-container">
                        <div id="skillsList" class="items-list"></div>
                        <button onclick="addSkillCategory()" class="btn btn-secondary">Add Skill Category</button>
                        <button onclick="saveSkills()" class="btn" style="margin-top: 2rem;">Save All Skills</button>
                    </div>
                </div>
                
                <!-- Projects Editor -->
                <div id="projectsSection" class="section-content" style="display: none;">
                    <h2>Edit Projects</h2>
                    <div class="editor-container">
                        <div id="projectsList" class="items-list"></div>
                        <button onclick="addProject()" class="btn btn-secondary">Add New Project</button>
                        <button onclick="saveProjects()" class="btn" style="margin-top: 2rem;">Save All Projects</button>
                    </div>
                </div>
                
                <!-- Contact Editor -->
                <div id="contactSection" class="section-content" style="display: none;">
                    <h2>Edit Contact Information</h2>
                    <div class="editor-container">
                        <div class="editor-group">
                            <label>Email Address</label>
                            <input type="email" id="contactEmail" placeholder="contact@example.com">
                        </div>
                        
                        <div class="editor-group">
                            <label>Phone Number</label>
                            <input type="text" id="contactPhone" placeholder="+91 1234567890">
                        </div>
                        
                        <div class="editor-group">
                            <label>Location</label>
                            <input type="text" id="contactLocation" placeholder="Based in India, Serving Globally">
                        </div>
                        
                        <div class="editor-group">
                            <label>Social Media Links</label>
                            <div id="socialLinksContainer"></div>
                            <button type="button" onclick="addSocialLink()" class="btn btn-sm btn-secondary" style="margin-top: 1rem;">Add Social Link</button>
                        </div>
                        
                        <button onclick="saveContact()" class="btn">Save Contact Info</button>
                    </div>
                </div>
                
                <!-- Messages Viewer -->
                <div id="messagesSection" class="section-content" style="display: none;">
                    <h2>Contact Messages</h2>
                    <div id="messagesList" class="editor-container"></div>
                </div>
                
                <!-- Settings -->
                <div id="settingsSection" class="section-content" style="display: none;">
                    <h2>Settings</h2>
                    <div class="editor-container">
                        <div class="editor-group">
                            <label>Admin Username</label>
                            <input type="text" id="adminUsername" value="admin">
                        </div>
                        
                        <div class="editor-group">
                            <label>Admin Password</label>
                            <input type="password" id="adminPassword" placeholder="Enter new password">
                        </div>
                        
                        <div class="editor-group">
                            <label>Confirm Password</label>
                            <input type="password" id="adminPasswordConfirm" placeholder="Confirm new password">
                        </div>
                        
                        <button onclick="saveSettings()" class="btn">Save Settings</button>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script type="module">
        // ======================
        // FIREBASE CONFIGURATION v12.7.0
        // ======================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            doc, 
            getDoc, 
            getDocs, 
            setDoc, 
            updateDoc, 
            addDoc, 
            deleteDoc,
            query, 
            orderBy, 
            where,
            serverTimestamp,
            Timestamp 
        } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyB9bnvM73DTkPxSinzEPvQ8QyIR-3DDWaY",
            authDomain: "ajay-gaur-portfolio-d33ee.firebaseapp.com",
            projectId: "ajay-gaur-portfolio-d33ee",
            storageBucket: "ajay-gaur-portfolio-d33ee.firebasestorage.app",
            messagingSenderId: "29220112890",
            appId: "1:29220112890:web:9c7be5a7a1d2abdba8fc43"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        // ======================
        // AUTHENTICATION
        // ======================
        let currentAdmin = null;
        
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            showLoading();
            
            try {
                // Check admin credentials from Firestore
                const adminDoc = await getDoc(doc(db, 'admin', 'credentials'));
                
                if (adminDoc.exists()) {
                    const credentials = adminDoc.data();
                    
                    if (username === credentials.username && password === credentials.password) {
                        // Login successful
                        currentAdmin = username;
                        localStorage.setItem('adminLoggedIn', 'true');
                        showDashboard();
                    } else {
                        document.getElementById('loginError').textContent = 'Invalid username or password';
                    }
                } else {
                    // First time setup - create default admin
                    await setDoc(doc(db, 'admin', 'credentials'), {
                        username: 'admin',
                        password: 'admin123',
                        createdAt: serverTimestamp()
                    });
                    
                    if (username === 'admin' && password === 'admin123') {
                        currentAdmin = username;
                        localStorage.setItem('adminLoggedIn', 'true');
                        showDashboard();
                    } else {
                        document.getElementById('loginError').textContent = 'Invalid credentials';
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginError').textContent = 'Login failed. Please try again.';
            } finally {
                hideLoading();
            }
        });
        
        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            loadDashboard();
        }
        
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            currentAdmin = null;
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('loginForm').reset();
        }
        
        // Check if already logged in
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            showDashboard();
        }
        
        // ======================
        // DASHBOARD FUNCTIONS
        // ======================
        async function loadDashboard() {
            showLoading();
            
            try {
                // Load quick stats
                const messagesQuery = query(
                    collection(db, 'contactMessages'),
                    orderBy('timestamp', 'desc'),
                    where('timestamp', '!=', null)
                );
                const messagesSnapshot = await getDocs(messagesQuery);
                
                const unreadQuery = query(
                    collection(db, 'contactMessages'),
                    where('read', '==', false)
                );
                const unreadSnapshot = await getDocs(unreadQuery);
                
                document.getElementById('quickStats').innerHTML = `
                    <p>Total Messages: ${messagesSnapshot.size}</p>
                    <p>Unread Messages: ${unreadSnapshot.size}</p>
                `;
                
                // Load recent messages
                let messagesHtml = '';
                const recentMessages = [];
                messagesSnapshot.forEach(doc => {
                    if (recentMessages.length < 5) {
                        recentMessages.push({ id: doc.id, ...doc.data() });
                    }
                });
                
                recentMessages.forEach(msg => {
                    const date = msg.timestamp ? formatDate(msg.timestamp) : 'Just now';
                    messagesHtml += `
                        <div style="border-bottom: 1px solid #e5e7eb; padding: 0.5rem 0;">
                            <strong>${msg.name}</strong> - ${msg.email}<br>
                            <small>${msg.message.substring(0, 50)}...</small><br>
                            <small style="color: #666;">${date}</small>
                        </div>
                    `;
                });
                
                document.getElementById('recentMessages').innerHTML = messagesHtml || '<p>No messages yet.</p>';
                
                // Load all sections
                await loadHeroSection();
                await loadAboutSection();
                await loadServices();
                await loadSkills();
                await loadProjects();
                await loadContact();
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('quickStats').innerHTML = '<p>Error loading stats</p>';
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // HERO SECTION EDITOR
        // ======================
        let heroStats = [];
        
        async function loadHeroSection() {
            try {
                const heroDoc = await getDoc(doc(db, 'website', 'hero'));
                
                if (heroDoc.exists()) {
                    const data = heroDoc.data();
                    document.getElementById('siteTitle').value = data.siteTitle || 'Ajay Kumar Gaur';
                    document.getElementById('heroTitle').value = data.title || '';
                    document.getElementById('heroSubtitle').value = data.subtitle || '';
                    
                    if (data.profileImage) {
                        document.getElementById('profileImagePreview').src = data.profileImage;
                        document.getElementById('profileImagePreview').style.display = 'block';
                    }
                    
                    // Load stats
                    heroStats = data.stats || [];
                    renderStats();
                }
                
                // Image upload handler
                document.getElementById('profileImageInput').addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        await uploadProfileImage(file);
                    }
                });
                
                document.getElementById('imageUpload').addEventListener('click', function() {
                    document.getElementById('profileImageInput').click();
                });
                
            } catch (error) {
                console.error('Error loading hero section:', error);
            }
        }
        
        function renderStats() {
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = '';
            
            heroStats.forEach((stat, index) => {
                statsContainer.innerHTML += `
                    <div class="item-card">
                        <input type="text" placeholder="Stat Value" value="${stat.value || ''}" 
                               onchange="updateStatValue(${index}, this.value)" style="width: 100px; margin-right: 1rem;">
                        <input type="text" placeholder="Stat Label" value="${stat.label || ''}" 
                               onchange="updateStatLabel(${index}, this.value)" style="width: 200px;">
                        <button onclick="removeStat(${index})" class="btn btn-sm btn-danger" style="float: right;">Remove</button>
                    </div>
                `;
            });
        }
        
        function addStat() {
            heroStats.push({ value: '', label: '' });
            renderStats();
        }
        
        function updateStatValue(index, value) {
            if (!heroStats[index]) heroStats[index] = {};
            heroStats[index].value = value;
        }
        
        function updateStatLabel(index, label) {
            if (!heroStats[index]) heroStats[index] = {};
            heroStats[index].label = label;
        }
        
        function removeStat(index) {
            heroStats.splice(index, 1);
            renderStats();
        }
        
        async function uploadProfileImage(file) {
            showLoading();
            
            try {
                const storageRef = ref(storage, `profile-images/${Date.now()}_${file.name}`);
                await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(storageRef);
                
                // Update preview
                document.getElementById('profileImagePreview').src = downloadURL;
                document.getElementById('profileImagePreview').style.display = 'block';
                
                // Save to hero data
                await updateDoc(doc(db, 'website', 'hero'), {
                    profileImage: downloadURL
                });
                
                showSuccess('Profile image uploaded successfully!');
            } catch (error) {
                console.error('Error uploading image:', error);
                alert('Error uploading image. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        async function saveHero() {
            showLoading();
            
            try {
                await setDoc(doc(db, 'website', 'hero'), {
                    siteTitle: document.getElementById('siteTitle').value,
                    title: document.getElementById('heroTitle').value,
                    subtitle: document.getElementById('heroSubtitle').value,
                    stats: heroStats.filter(stat => stat.value && stat.label),
                    updatedAt: serverTimestamp()
                }, { merge: true });
                
                showSuccess('Hero section saved successfully!');
            } catch (error) {
                console.error('Error saving hero section:', error);
                alert('Error saving hero section. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // ABOUT SECTION EDITOR
        // ======================
        async function loadAboutSection() {
            try {
                const aboutDoc = await getDoc(doc(db, 'website', 'about'));
                if (aboutDoc.exists()) {
                    const data = aboutDoc.data();
                    document.getElementById('aboutContent').value = data.content || '';
                }
            } catch (error) {
                console.error('Error loading about section:', error);
            }
        }
        
        async function saveAbout() {
            showLoading();
            
            try {
                await setDoc(doc(db, 'website', 'about'), {
                    content: document.getElementById('aboutContent').value,
                    updatedAt: serverTimestamp()
                }, { merge: true });
                
                showSuccess('About section saved successfully!');
            } catch (error) {
                console.error('Error saving about section:', error);
                alert('Error saving about section. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // SERVICES EDITOR
        // ======================
        let services = [];
        
        async function loadServices() {
            try {
                const servicesQuery = query(collection(db, 'services'), orderBy('order'));
                const snapshot = await getDocs(servicesQuery);
                services = [];
                
                snapshot.forEach(doc => {
                    services.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderServices();
            } catch (error) {
                console.error('Error loading services:', error);
            }
        }
        
        function renderServices() {
            const container = document.getElementById('servicesList');
            container.innerHTML = '';
            
            services.forEach((service, index) => {
                container.innerHTML += `
                    <div class="item-card">
                        <input type="text" placeholder="Service Title" value="${service.title || ''}" 
                               onchange="updateServiceField(${index}, 'title', this.value)" style="margin-bottom: 0.5rem; width: 100%;">
                        <textarea placeholder="Service Description" 
                                  onchange="updateServiceField(${index}, 'description', this.value)" 
                                  style="width: 100%; margin-bottom: 0.5rem;">${service.description || ''}</textarea>
                        <input type="text" placeholder="Icon (emoji)" value="${service.icon || 'ðŸ’¼'}" 
                               onchange="updateServiceField(${index}, 'icon', this.value)" style="width: 100px;">
                        <input type="number" placeholder="Order" value="${service.order || index}" 
                               onchange="updateServiceField(${index}, 'order', parseInt(this.value))" style="width: 80px; margin-left: 1rem;">
                        <button onclick="removeService(${index})" class="btn btn-sm btn-danger" style="float: right;">Remove</button>
                    </div>
                `;
            });
        }
        
        function addService() {
            services.push({
                title: '',
                description: '',
                icon: 'ðŸ’¼',
                order: services.length
            });
            renderServices();
        }
        
        function updateServiceField(index, field, value) {
            if (services[index]) {
                services[index][field] = value;
            }
        }
        
        function removeService(index) {
            services.splice(index, 1);
            renderServices();
        }
        
        async function saveServices() {
            showLoading();
            
            try {
                // Delete all existing services
                const snapshot = await getDocs(collection(db, 'services'));
                const deletePromises = [];
                snapshot.forEach(doc => {
                    deletePromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deletePromises);
                
                // Save new services
                const savePromises = services
                    .filter(service => service.title && service.description)
                    .map((service, index) => {
                        const { id, ...serviceData } = service;
                        return addDoc(collection(db, 'services'), {
                            ...serviceData,
                            order: index
                        });
                    });
                
                await Promise.all(savePromises);
                showSuccess('Services saved successfully!');
            } catch (error) {
                console.error('Error saving services:', error);
                alert('Error saving services. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // SKILLS EDITOR
        // ======================
        let skills = [];
        
        async function loadSkills() {
            try {
                const skillsQuery = query(collection(db, 'skills'), orderBy('order'));
                const snapshot = await getDocs(skillsQuery);
                skills = [];
                
                snapshot.forEach(doc => {
                    skills.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderSkills();
            } catch (error) {
                console.error('Error loading skills:', error);
            }
        }
        
        function renderSkills() {
            const container = document.getElementById('skillsList');
            container.innerHTML = '';
            
            skills.forEach((skill, index) => {
                const items = skill.items ? skill.items.join(', ') : '';
                container.innerHTML += `
                    <div class="item-card">
                        <input type="text" placeholder="Category Name" value="${skill.category || ''}" 
                               onchange="updateSkillField(${index}, 'category', this.value)" style="margin-bottom: 0.5rem; width: 100%;">
                        <input type="text" placeholder="Skills (comma separated)" value="${items}" 
                               onchange="updateSkillItems(${index}, this.value)" style="width: 100%; margin-bottom: 0.5rem;">
                        <input type="number" placeholder="Order" value="${skill.order || index}" 
                               onchange="updateSkillField(${index}, 'order', parseInt(this.value))" style="width: 80px;">
                        <button onclick="removeSkillCategory(${index})" class="btn btn-sm btn-danger" style="float: right;">Remove</button>
                    </div>
                `;
            });
        }
        
        function addSkillCategory() {
            skills.push({
                category: '',
                items: [],
                order: skills.length
            });
            renderSkills();
        }
        
        function updateSkillField(index, field, value) {
            if (skills[index]) {
                skills[index][field] = value;
            }
        }
        
        function updateSkillItems(index, value) {
            if (skills[index]) {
                skills[index].items = value.split(',').map(item => item.trim()).filter(item => item);
            }
        }
        
        function removeSkillCategory(index) {
            skills.splice(index, 1);
            renderSkills();
        }
        
        async function saveSkills() {
            showLoading();
            
            try {
                // Delete all existing skills
                const snapshot = await getDocs(collection(db, 'skills'));
                const deletePromises = [];
                snapshot.forEach(doc => {
                    deletePromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deletePromises);
                
                // Save new skills
                const savePromises = skills
                    .filter(skill => skill.category && skill.items && skill.items.length > 0)
                    .map((skill, index) => {
                        const { id, ...skillData } = skill;
                        return addDoc(collection(db, 'skills'), {
                            ...skillData,
                            order: index
                        });
                    });
                
                await Promise.all(savePromises);
                showSuccess('Skills saved successfully!');
            } catch (error) {
                console.error('Error saving skills:', error);
                alert('Error saving skills. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // PROJECTS EDITOR
        // ======================
        let projects = [];
        
        async function loadProjects() {
            try {
                const projectsQuery = query(collection(db, 'projects'), orderBy('order'));
                const snapshot = await getDocs(projectsQuery);
                projects = [];
                
                snapshot.forEach(doc => {
                    projects.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                renderProjects();
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }
        
        function renderProjects() {
            const container = document.getElementById('projectsList');
            container.innerHTML = '';
            
            projects.forEach((project, index) => {
                const tags = project.tags ? project.tags.join(', ') : '';
                container.innerHTML += `
                    <div class="item-card">
                        <input type="text" placeholder="Project Title" value="${project.title || ''}" 
                               onchange="updateProjectField(${index}, 'title', this.value)" style="margin-bottom: 0.5rem; width: 100%;">
                        <textarea placeholder="Project Description" 
                                  onchange="updateProjectField(${index}, 'description', this.value)" 
                                  style="width: 100%; margin-bottom: 0.5rem;">${project.description || ''}</textarea>
                        <input type="text" placeholder="Image URL" value="${project.image || ''}" 
                               onchange="updateProjectField(${index}, 'image', this.value)" style="width: 100%; margin-bottom: 0.5rem;">
                        <input type="text" placeholder="Tags (comma separated)" value="${tags}" 
                               onchange="updateProjectTags(${index}, this.value)" style="width: 100%; margin-bottom: 0.5rem;">
                        <input type="number" placeholder="Order" value="${project.order || index}" 
                               onchange="updateProjectField(${index}, 'order', parseInt(this.value))" style="width: 80px;">
                        <button onclick="removeProject(${index})" class="btn btn-sm btn-danger" style="float: right;">Remove</button>
                    </div>
                `;
            });
        }
        
        function addProject() {
            projects.push({
                title: '',
                description: '',
                image: '',
                tags: [],
                order: projects.length
            });
            renderProjects();
        }
        
        function updateProjectField(index, field, value) {
            if (projects[index]) {
                projects[index][field] = value;
            }
        }
        
        function updateProjectTags(index, value) {
            if (projects[index]) {
                projects[index].tags = value.split(',').map(tag => tag.trim()).filter(tag => tag);
            }
        }
        
        function removeProject(index) {
            projects.splice(index, 1);
            renderProjects();
        }
        
        async function saveProjects() {
            showLoading();
            
            try {
                // Delete all existing projects
                const snapshot = await getDocs(collection(db, 'projects'));
                const deletePromises = [];
                snapshot.forEach(doc => {
                    deletePromises.push(deleteDoc(doc.ref));
                });
                await Promise.all(deletePromises);
                
                // Save new projects
                const savePromises = projects
                    .filter(project => project.title && project.description)
                    .map((project, index) => {
                        const { id, ...projectData } = project;
                        return addDoc(collection(db, 'projects'), {
                            ...projectData,
                            order: index
                        });
                    });
                
                await Promise.all(savePromises);
                showSuccess('Projects saved successfully!');
            } catch (error) {
                console.error('Error saving projects:', error);
                alert('Error saving projects. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // CONTACT EDITOR
        // ======================
        let socialLinks = [];
        
        async function loadContact() {
            try {
                const contactDoc = await getDoc(doc(db, 'website', 'contact'));
                
                if (contactDoc.exists()) {
                    const data = contactDoc.data();
                    document.getElementById('contactEmail').value = data.email || '';
                    document.getElementById('contactPhone').value = data.phone || '';
                    document.getElementById('contactLocation').value = data.location || '';
                    
                    socialLinks = data.social || [];
                    renderSocialLinks();
                }
            } catch (error) {
                console.error('Error loading contact:', error);
            }
        }
        
        function renderSocialLinks() {
            const container = document.getElementById('socialLinksContainer');
            container.innerHTML = '';
            
            socialLinks.forEach((link, index) => {
                container.innerHTML += `
                    <div class="item-card" style="margin-bottom: 0.5rem;">
                        <input type="text" placeholder="Platform Name" value="${link.name || ''}" 
                               onchange="updateSocialLinkField(${index}, 'name', this.value)" style="width: 150px; margin-right: 1rem;">
                        <input type="url" placeholder="URL" value="${link.url || ''}" 
                               onchange="updateSocialLinkField(${index}, 'url', this.value)" style="width: 300px;">
                        <button onclick="removeSocialLink(${index})" class="btn btn-sm btn-danger" style="float: right;">Remove</button>
                    </div>
                `;
            });
        }
        
        function addSocialLink() {
            socialLinks.push({ name: '', url: '' });
            renderSocialLinks();
        }
        
        function updateSocialLinkField(index, field, value) {
            if (socialLinks[index]) {
                socialLinks[index][field] = value;
            }
        }
        
        function removeSocialLink(index) {
            socialLinks.splice(index, 1);
            renderSocialLinks();
        }
        
        async function saveContact() {
            showLoading();
            
            try {
                await setDoc(doc(db, 'website', 'contact'), {
                    email: document.getElementById('contactEmail').value,
                    phone: document.getElementById('contactPhone').value,
                    location: document.getElementById('contactLocation').value,
                    social: socialLinks.filter(link => link.name && link.url),
                    updatedAt: serverTimestamp()
                }, { merge: true });
                
                showSuccess('Contact information saved successfully!');
            } catch (error) {
                console.error('Error saving contact:', error);
                alert('Error saving contact information. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // MESSAGES VIEWER
        // ======================
        async function loadMessages() {
            showLoading();
            
            try {
                const messagesQuery = query(
                    collection(db, 'contactMessages'),
                    orderBy('timestamp', 'desc')
                );
                const snapshot = await getDocs(messagesQuery);
                
                let messagesHtml = '';
                
                snapshot.forEach(doc => {
                    const msg = doc.data();
                    const date = msg.timestamp ? formatDate(msg.timestamp) : 'Just now';
                    
                    messagesHtml += `
                        <div style="border-bottom: 1px solid #e5e7eb; padding: 1rem 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${msg.name}</strong>
                                <small>${date}</small>
                            </div>
                            <div style="margin-bottom: 0.5rem;">
                                <strong>Email:</strong> ${msg.email}
                            </div>
                            <div>
                                <strong>Message:</strong><br>
                                ${msg.message}
                            </div>
                            ${!msg.read ? `<button onclick="markAsRead('${doc.id}')" class="btn btn-sm" style="margin-top: 0.5rem;">Mark as Read</button>` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('messagesList').innerHTML = messagesHtml || '<p>No messages yet.</p>';
                
            } catch (error) {
                console.error('Error loading messages:', error);
            } finally {
                hideLoading();
            }
        }
        
        async function markAsRead(messageId) {
            try {
                await updateDoc(doc(db, 'contactMessages', messageId), {
                    read: true
                });
                loadMessages(); // Reload messages
            } catch (error) {
                console.error('Error marking message as read:', error);
            }
        }
        
        // ======================
        // SETTINGS
        // ======================
        async function saveSettings() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const confirmPassword = document.getElementById('adminPasswordConfirm').value;
            
            if (password && password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            showLoading();
            
            try {
                const updateData = {
                    username: username,
                    updatedAt: serverTimestamp()
                };
                
                if (password) {
                    updateData.password = password;
                }
                
                await setDoc(doc(db, 'admin', 'credentials'), updateData, { merge: true });
                
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPasswordConfirm').value = '';
                
                showSuccess('Settings saved successfully!');
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Error saving settings. Please try again.');
            } finally {
                hideLoading();
            }
        }
        
        // ======================
        // UTILITY FUNCTIONS
        // ======================
        function formatDate(timestamp) {
            if (!timestamp) return 'Just now';
            
            let date;
            if (timestamp.toDate) {
                date = timestamp.toDate();
            } else if (timestamp instanceof Date) {
                date = timestamp;
            } else if (timestamp.seconds) {
                date = new Date(timestamp.seconds * 1000);
            } else {
                date = new Date(timestamp);
            }
            
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section-content').forEach(section => {
                section.style.display = 'none';
            });
            
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(`${sectionId}Section`).style.display = 'block';
            
            // Add active class to clicked nav link
            event.target.classList.add('active');
            
            // Load section data if needed
            if (sectionId === 'messages') {
                loadMessages();
            } else if (sectionId === 'dashboard') {
                loadDashboard();
            }
        }
        
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }
        
        // Make functions available globally
        window.addStat = addStat;
        window.updateStatValue = updateStatValue;
        window.updateStatLabel = updateStatLabel;
        window.removeStat = removeStat;
        window.saveHero = saveHero;
        window.saveAbout = saveAbout;
        window.addService = addService;
        window.updateServiceField = updateServiceField;
        window.removeService = removeService;
        window.saveServices = saveServices;
        window.addSkillCategory = addSkillCategory;
        window.updateSkillField = updateSkillField;
        window.updateSkillItems = updateSkillItems;
        window.removeSkillCategory = removeSkillCategory;
        window.saveSkills = saveSkills;
        window.addProject = addProject;
        window.updateProjectField = updateProjectField;
        window.updateProjectTags = updateProjectTags;
        window.removeProject = removeProject;
        window.saveProjects = saveProjects;
        window.addSocialLink = addSocialLink;
        window.updateSocialLinkField = updateSocialLinkField;
        window.removeSocialLink = removeSocialLink;
        window.saveContact = saveContact;
        window.markAsRead = markAsRead;
        window.saveSettings = saveSettings;
        window.showSection = showSection;
        window.logout = logout;
    </script>
</body>
</html>
